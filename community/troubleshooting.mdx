---
title: "Troubleshooting Guide"
description: "Comprehensive troubleshooting guide for SundayPyjamas AI Suite common issues"
---

## Overview

This troubleshooting guide helps you resolve common issues with SundayPyjamas AI Suite. If you can't find a solution here, check our [community forums](https://community.sundaypyjamas.com) or contact [support](mailto:support@sundaypyjamas.com).

## Quick Start Issues

### API Key Problems

<AccordionGroup>
<Accordion title="Invalid API Key Error">
**Symptoms:**
- `401 Unauthorized` error
- "Invalid API key" message
- Authentication failed errors

**Solutions:**
1. **Verify API Key Format**: Ensure your API key starts with `spj_ai_` and is 64 characters long
2. **Check API Key**: Make sure you're using the correct API key from your workspace
3. **Active Status**: Verify your API key is active and not expired
4. **Correct Header**: Ensure you're using `Authorization: Bearer spj_ai_your_key_here`

**Code Example:**
```javascript
// ❌ Wrong
const response = await fetch('/api/chat', {
  headers: {
    'Authorization': 'spj_ai_your_key_here' // Missing Bearer
  }
});

// ✅ Correct
const response = await fetch('/api/chat', {
  headers: {
    'Authorization': 'Bearer spj_ai_your_key_here'
  }
});
```
</Accordion>

<Accordion title="API Key Not Working in Environment">
**Symptoms:**
- Works with hardcoded key but fails with environment variable
- Environment variable not recognized

**Solutions:**
1. **Environment Variable Name**: Ensure variable is named correctly
2. **Restart Application**: Restart your app after setting environment variables
3. **File Location**: Check `.env` file location and format
4. **Loading**: Verify environment variables are loaded properly

**Code Example:**
```javascript
// .env
SUNDAYPYJAMAS_API_KEY=spj_ai_your_key_here

// app.js
import 'dotenv/config'; // Load environment variables
const apiKey = process.env.SUNDAYPYJAMAS_API_KEY;
```
</Accordion>
</AccordionGroup>

### Network & Connectivity

<AccordionGroup>
<Accordion title="Connection Timeout">
**Symptoms:**
- Request hangs for 30+ seconds
- `ECONNABORTED` or timeout errors
- Slow response times

**Solutions:**
1. **Increase Timeout**: Set appropriate timeout values
2. **Check Network**: Verify internet connectivity
3. **Proxy Settings**: Check if proxy is configured correctly
4. **DNS Resolution**: Verify DNS resolution

**Code Example:**
```javascript
// Increase timeout
const response = await fetch('https://suite.sundaypyjamas.com/api/v1/chat', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${apiKey}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({ messages }),
  timeout: 60000 // 60 seconds
});
```
</Accordion>

<Accordion title="CORS Errors">
**Symptoms:**
- Browser console shows CORS errors
- Preflight request failures
- "Access-Control-Allow-Origin" errors

**Solutions:**
1. **Proxy Requests**: Make API calls from your backend, not frontend
2. **CORS Headers**: Configure proper CORS headers in your server
3. **Environment**: Use environment variables for API keys

**Code Example:**
```javascript
// ❌ Don't expose API key in frontend
const response = await fetch('https://suite.sundaypyjamas.com/api/v1/chat', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${apiKey}`, // API key exposed!
    'Content-Type': 'application/json',
  }
});

// ✅ Use backend proxy
const response = await fetch('/api/chat', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({ messages })
});
```
</Accordion>
</AccordionGroup>

## Chat API Issues

### Request Format Problems

<AccordionGroup>
<Accordion title="Invalid Request Format">
**Symptoms:**
- `400 Bad Request` error
- "Invalid request format" message
- Validation errors

**Solutions:**
1. **Message Structure**: Ensure messages have `role` and `content` fields
2. **Role Values**: Use only `user`, `assistant`, or `system`
3. **Content Type**: Set correct Content-Type header
4. **JSON Format**: Ensure request body is valid JSON

**Code Example:**
```javascript
// ❌ Invalid format
const invalidRequest = {
  messages: [
    { text: 'Hello' } // Missing role and content
  ]
};

// ✅ Valid format
const validRequest = {
  messages: [
    {
      role: 'user',
      content: 'Hello, how are you?'
    }
  ]
};
```
</Accordion>

<Accordion title="Empty Response">
**Symptoms:**
- API returns empty response
- No error but no content either
- Response object is missing data

**Solutions:**
1. **Model Selection**: Verify model is available and working
2. **Message Content**: Ensure messages have meaningful content
3. **Temperature**: Adjust temperature parameter (try 0.7)
4. **Max Tokens**: Ensure max_tokens is sufficient

**Code Example:**
```javascript
const response = await ai.chat({
  messages: [
    {
      role: 'user',
      content: 'Please provide a detailed explanation.' // More specific prompt
    }
  ],
  model: 'llama-3.3-70b-versatile',
  temperature: 0.7,
  max_tokens: 1000
});
```
</Accordion>
</AccordionGroup>

### Streaming Problems

<AccordionGroup>
<Accordion title="Streaming Not Working">
**Symptoms:**
- Streaming responses don't work
- Fallback to regular responses
- Connection issues during streaming

**Solutions:**
1. **Browser Support**: Ensure browser supports streaming
2. **Headers**: Verify proper headers for streaming
3. **Connection**: Check network connection stability
4. **Fallback**: Implement fallback for non-streaming

**Code Example:**
```javascript
// Check if streaming is supported
const supportsStreaming = 'ReadableStream' in window;

if (supportsStreaming) {
  // Use streaming
  const stream = ai.chatStream({
    messages,
    model: 'llama-3.3-70b-versatile'
  });

  for await (const chunk of stream) {
    // Handle streaming chunk
  }
} else {
  // Fallback to regular request
  const response = await ai.chat({
    messages,
    model: 'llama-3.3-70b-versatile'
  });
}
```
</Accordion>

<Accordion title="Streaming Connection Drops">
**Symptoms:**
- Streaming stops mid-response
- Connection timeout errors
- Intermittent streaming failures

**Solutions:**
1. **Reconnection Logic**: Implement automatic reconnection
2. **Error Handling**: Handle connection errors gracefully
3. **Timeout Settings**: Adjust timeout settings
4. **Network Stability**: Check network stability

**Code Example:**
```javascript
class StreamingHandler {
  constructor() {
    this.maxRetries = 3;
    this.retryDelay = 1000;
  }

  async startStreamingWithRetry(messages, onChunk, onError, onComplete) {
    let attempt = 0;

    while (attempt < this.maxRetries) {
      try {
        const stream = ai.chatStream({
          messages,
          model: 'llama-3.3-70b-versatile'
        });

        for await (const chunk of stream) {
          onChunk(chunk);
        }

        onComplete();
        return;

      } catch (error) {
        attempt++;

        if (attempt >= this.maxRetries) {
          onError(error);
          return;
        }

        // Wait before retry
        await new Promise(resolve => setTimeout(resolve, this.retryDelay * attempt));
      }
    }
  }
}
```
</Accordion>
</AccordionGroup>

## Rate Limiting Issues

<AccordionGroup>
<Accordion title="Rate Limit Exceeded">
**Symptoms:**
- `429 Too Many Requests` error
- "Rate limit exceeded" message
- Requests being blocked

**Solutions:**
1. **Implement Delays**: Add delays between requests
2. **Batch Requests**: Use batch processing for multiple requests
3. **Rate Limiting**: Implement client-side rate limiting
4. **Upgrade Plan**: Consider upgrading your plan for higher limits

**Code Example:**
```javascript
class RateLimiter {
  constructor(requestsPerSecond = 1) {
    this.requestsPerSecond = requestsPerSecond;
    this.lastRequestTime = 0;
  }

  async checkLimit() {
    const now = Date.now();
    const timeSinceLastRequest = now - this.lastRequestTime;
    const minInterval = 1000 / this.requestsPerSecond;

    if (timeSinceLastRequest < minInterval) {
      await new Promise(resolve =>
        setTimeout(resolve, minInterval - timeSinceLastRequest)
      );
    }

    this.lastRequestTime = Date.now();
  }

  async makeRequest(request) {
    await this.checkLimit();
    return await ai.chat(request);
  }
}

const rateLimiter = new RateLimiter(2); // 2 requests per second
const response = await rateLimiter.makeRequest({
  messages: [{ role: 'user', content: 'Hello!' }]
});
```
</Accordion>

<Accordion title="Bursting Through Limits">
**Symptoms:**
- Occasional rate limit errors during bursts
- Inconsistent request success
- Need for handling rate limit bursts

**Solutions:**
1. **Exponential Backoff**: Implement exponential backoff for retries
2. **Queue System**: Use a queue to manage request timing
3. **Token Bucket**: Implement token bucket algorithm
4. **Circuit Breaker**: Add circuit breaker pattern

**Code Example:**
```javascript
class ExponentialBackoff {
  async withBackoff(fn, maxRetries = 3) {
    let attempt = 0;

    while (attempt < maxRetries) {
      try {
        return await fn();
      } catch (error) {
        if (error.status === 429 && attempt < maxRetries - 1) {
          const delay = Math.pow(2, attempt) * 1000; // Exponential backoff
          await new Promise(resolve => setTimeout(resolve, delay));
          attempt++;
        } else {
          throw error;
        }
      }
    }
  }
}

const backoff = new ExponentialBackoff();
const response = await backoff.withBackoff(() =>
  ai.chat({
    messages: [{ role: 'user', content: 'Hello!' }]
  })
);
```
</Accordion>
</AccordionGroup>

## Model-Specific Issues

### Context Length Problems

<AccordionGroup>
<Accordion title="Context Length Exceeded">
**Symptoms:**
- "Context length exceeded" error
- Requests fail with long conversations
- Token limit errors

**Solutions:**
1. **Summarize History**: Implement conversation summarization
2. **Limit History**: Keep only recent messages
3. **Truncate Messages**: Truncate long individual messages
4. **Context Management**: Implement smart context management

**Code Example:**
```javascript
class ContextManager {
  constructor(maxTokens = 4000) {
    this.maxTokens = maxTokens;
    this.estimatedTokensPerMessage = 4;
  }

  optimizeMessages(messages) {
    const maxMessages = Math.floor(this.maxTokens / this.estimatedTokensPerMessage);
    const recentMessages = messages.slice(-maxMessages);

    // If still too long, summarize older messages
    if (this.estimateTokens(recentMessages) > this.maxTokens) {
      return this.summarizeAndTruncate(recentMessages);
    }

    return recentMessages;
  }

  estimateTokens(messages) {
    return messages.reduce((total, msg) => {
      return total + (msg.content.length * this.estimatedTokensPerMessage / 4);
    }, 0);
  }

  async summarizeAndTruncate(messages) {
    if (messages.length <= 2) return messages;

    const summary = await ai.chat({
      messages: [
        {
          role: 'user',
          content: `Summarize this conversation in 2-3 sentences: ${messages.slice(0, -2).map(m => m.content).join('\n')}`
        }
      ]
    });

    return [
      {
        role: 'system',
        content: `Previous conversation summary: ${summary.choices[0].message.content}`
      },
      ...messages.slice(-2)
    ];
  }
}
```
</Accordion>
</AccordionGroup>

## SDK-Specific Issues

### JavaScript SDK

<AccordionGroup>
<Accordion title="Module Not Found Error">
**Symptoms:**
- "Cannot find module '@sundaypyjamas/ai-sdk'" error
- Import errors in Node.js
- Browser loading issues

**Solutions:**
1. **Install Package**: Run `npm install @sundaypyjamas/ai-sdk`
2. **Check Version**: Verify compatible Node.js version (18+)
3. **Clear Cache**: Clear npm cache and reinstall
4. **Import Syntax**: Use correct import syntax

**Code Example:**
```javascript
// Node.js
const { SundayPyjamasAI } = require('@sundaypyjamas/ai-sdk');

// ES6 Modules
import { SundayPyjamasAI } from '@sundaypyjamas/ai-sdk';

// TypeScript
import { SundayPyjamasAI, ChatRequest, ChatResponse } from '@sundaypyjamas/ai-sdk';
```
</Accordion>

<Accordion title="TypeScript Type Errors">
**Symptoms:**
- TypeScript compilation errors
- Type mismatch errors
- Missing type definitions

**Solutions:**
1. **TypeScript Version**: Ensure TypeScript 4.5+ is installed
2. **Type Definitions**: Install type definitions if needed
3. **Import Types**: Import specific types from the SDK
4. **Type Casting**: Use type casting when necessary

**Code Example:**
```typescript
// Proper TypeScript usage
import { SundayPyjamasAI, ChatRequest, ChatResponse } from '@sundaypyjamas/ai-sdk';

const ai = new SundayPyjamasAI({
  apiKey: process.env.SUNDAYPYJAMAS_API_KEY
});

const request: ChatRequest = {
  messages: [
    {
      role: 'user',
      content: 'Hello, world!'
    }
  ],
  model: 'llama-3.3-70b-versatile',
  temperature: 0.7
};

const response: ChatResponse = await ai.chat(request);
```
</Accordion>
</AccordionGroup>

## Performance Issues

<AccordionGroup>
<Accordion title="Slow Response Times">
**Symptoms:**
- Responses taking longer than expected
- High latency in API calls
- Performance degradation over time

**Solutions:**
1. **Caching**: Implement response caching
2. **Connection Pooling**: Use connection pooling
3. **Optimize Requests**: Minimize request payload
4. **CDN**: Use CDN for static content
5. **Monitoring**: Set up performance monitoring

**Code Example:**
```javascript
class CachedAI {
  constructor(ai, cache) {
    this.ai = ai;
    this.cache = cache;
    this.cacheTTL = 300000; // 5 minutes
  }

  async chat(request) {
    const cacheKey = this.generateCacheKey(request);

    // Check cache first
    const cached = await this.cache.get(cacheKey);
    if (cached) {
      return JSON.parse(cached);
    }

    // Make API request
    const response = await this.ai.chat(request);

    // Cache response
    await this.cache.set(cacheKey, JSON.stringify(response), this.cacheTTL);

    return response;
  }

  generateCacheKey(request) {
    return `ai_cache:${JSON.stringify(request)}`;
  }
}
```
</Accordion>

<Accordion title="Memory Leaks">
**Symptoms:**
- Increasing memory usage over time
- Application slowdown
- Out of memory errors

**Solutions:**
1. **Close Connections**: Properly close streaming connections
2. **Garbage Collection**: Implement proper cleanup
3. **Memory Monitoring**: Monitor memory usage
4. **Connection Pooling**: Use connection pooling
5. **Memory Limits**: Set appropriate memory limits

**Code Example:**
```javascript
class ResourceManager {
  constructor() {
    this.activeConnections = new Set();
    this.cleanupInterval = setInterval(() => this.cleanup(), 30000);
  }

  addConnection(connection) {
    this.activeConnections.add(connection);
  }

  removeConnection(connection) {
    this.activeConnections.delete(connection);
  }

  async cleanup() {
    for (const connection of this.activeConnections) {
      if (connection.readyState === 'closed') {
        this.removeConnection(connection);
      }
    }

    // Force garbage collection if available
    if (global.gc) {
      global.gc();
    }
  }

  destroy() {
    clearInterval(this.cleanupInterval);
    this.activeConnections.clear();
  }
}
```
</Accordion>
</AccordionGroup>

## Framework-Specific Issues

### Next.js

<AccordionGroup>
<Accordion title="Build Errors">
**Symptoms:**
- Next.js build failures
- Module resolution errors
- TypeScript errors in build

**Solutions:**
1. **Dependencies**: Ensure all dependencies are installed
2. **Next.js Version**: Check Next.js compatibility
3. **Configuration**: Verify `next.config.js` settings
4. **Environment**: Check environment variables in build

**Code Example:**
```javascript
// next.config.js
module.exports = {
  experimental: {
    serverComponentsExternalPackages: ['@sundaypyjamas/ai-sdk']
  },
  env: {
    SUNDAYPYJAMAS_API_KEY: process.env.SUNDAYPYJAMAS_API_KEY
  }
};
```
</Accordion>

<Accordion title="API Route Issues">
**Symptoms:**
- API routes not working
- 404 errors on API endpoints
- Serverless function errors

**Solutions:**
1. **File Location**: Ensure API routes are in `pages/api/` or `app/api/`
2. **Export Format**: Use correct export format for API routes
3. **Environment Variables**: Verify environment variables are available
4. **Error Handling**: Implement proper error handling

**Code Example:**
```javascript
// pages/api/chat.js (Pages Router)
export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  try {
    const { messages } = req.body;
    // Process request
    res.status(200).json({ response: 'Success' });
  } catch (error) {
    console.error('API Error:', error);
    res.status(500).json({ error: error.message });
  }
}
```
</Accordion>
</AccordionGroup>

### FastAPI

<AccordionGroup>
<Accordion title="Async Issues">
**Symptoms:**
- Blocking operations in async endpoints
- Performance issues with concurrent requests
- Timeout errors

**Solutions:**
1. **Async/Await**: Use proper async/await syntax
2. **HTTP Client**: Use async HTTP client libraries
3. **Connection Pooling**: Implement connection pooling
4. **Concurrency**: Handle concurrent requests properly

**Code Example:**
```python
from fastapi import FastAPI, HTTPException
from sundaypyjamas_ai import SundayPyjamasAI
import asyncio
import aiohttp

app = FastAPI()
ai = SundayPyjamasAI(api_key="your_api_key")

@app.post("/chat")
async def chat_endpoint(messages: list):
    try:
        # Use async HTTP client
        async with aiohttp.ClientSession() as session:
            response = await ai.chat_async(messages)
            return {"response": response}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```
</Accordion>
</AccordionGroup>

## Advanced Troubleshooting

### Debug Mode

```javascript
// Enable debug logging
const ai = new SundayPyjamasAI({
  apiKey: process.env.SUNDAYPYJAMAS_API_KEY,
  debug: true
});

// Custom logger
const ai = new SundayPyjamasAI({
  apiKey: process.env.SUNDAYPYJAMAS_API_KEY,
  logger: {
    info: (msg) => console.log('INFO:', msg),
    error: (msg) => console.error('ERROR:', msg),
    debug: (msg) => console.debug('DEBUG:', msg)
  }
});
```

### Request/Response Logging

```javascript
class RequestLogger {
  static logRequest(request) {
    console.log('API Request:', {
      timestamp: new Date().toISOString(),
      model: request.model,
      messagesCount: request.messages?.length,
      temperature: request.temperature,
      maxTokens: request.max_tokens
    });
  }

  static logResponse(response, duration) {
    console.log('API Response:', {
      timestamp: new Date().toISOString(),
      duration: `${duration}ms`,
      tokens: response.usage,
      model: response.model,
      choicesCount: response.choices?.length
    });
  }

  static logError(error, request) {
    console.error('API Error:', {
      timestamp: new Date().toISOString(),
      error: error.message,
      status: error.status,
      request: request
    });
  }
}
```

### Health Checks

```javascript
class HealthChecker {
  constructor(ai) {
    this.ai = ai;
    this.healthStatus = 'unknown';
    this.lastCheck = null;
  }

  async checkHealth() {
    try {
      const startTime = Date.now();

      // Simple health check request
      await this.ai.chat({
        messages: [{ role: 'user', content: 'Hello' }],
        max_tokens: 10
      });

      const responseTime = Date.now() - startTime;
      this.healthStatus = responseTime < 5000 ? 'healthy' : 'degraded';
      this.lastCheck = new Date();

      return {
        status: this.healthStatus,
        responseTime,
        timestamp: this.lastCheck
      };
    } catch (error) {
      this.healthStatus = 'unhealthy';
      this.lastCheck = new Date();

      return {
        status: 'unhealthy',
        error: error.message,
        timestamp: this.lastCheck
      };
    }
  }

  getStatus() {
    return {
      status: this.healthStatus,
      lastCheck: this.lastCheck,
      timestamp: new Date()
    };
  }
}
```

## Getting Help

### Support Resources

1. **Documentation**: Check our comprehensive documentation
2. **Community**: Join our [developer community](https://community.sundaypyjamas.com)
3. **GitHub**: Report issues on [GitHub](https://github.com/sundaypyjamas/ai-suite/issues)
4. **Support**: Contact [enterprise support](mailto:enterprise@sundaypyjamas.com)

### Information to Provide

When seeking help, please include:

- **Version**: SDK version and platform
- **Code Snippet**: Minimal code that reproduces the issue
- **Error Message**: Complete error message and stack trace
- **Environment**: Node.js version, browser, OS
- **Steps**: Detailed steps to reproduce the issue
- **Expected vs Actual**: What you expected vs what happened

### Common Solutions

- **Clear Cache**: `npm cache clean --force`
- **Reinstall Dependencies**: Remove `node_modules` and `package-lock.json`, then `npm install`
- **Update SDK**: `npm update @sundaypyjamas/ai-sdk`
- **Check Network**: Verify internet connectivity and DNS
- **Environment Variables**: Ensure environment variables are set correctly

## Next Steps

<CardGroup cols={2}>
  <Card
    title: "API Reference"
    icon: "code"
    href: "/api-reference/chat/introduction"
  >
    Check detailed API documentation
  </Card>
  <Card
    title: "Examples"
    icon: "terminal"
    href: "/examples/javascript"
  >
    See working code examples
  </Card>
  <Card
    title: "Community"
    icon: "users"
    href: "/community"
  >
    Get help from the community
  </Card>
  <Card
    title: "Changelog"
    icon: "clock"
    href: "/community/changelog"
  >
    Check latest updates and fixes
  </Card>
</CardGroup>
